function E(e){return document.getElementById(e)}function V(e){return E(e).value.trim()}function startLoading(){E("loading").hidden=0}function stopLoading(){E("loading").hidden=1}function sleep(e){return new Promise(t=>setTimeout(t,e))}function Notice(e,t=2e3){function n(){noticefade&&(a.style.opacity-=.01)>0&&requestAnimationFrame(n)}var a=E("notice");a.innerText=e,a.style.opacity=1,noticefade=0,sleep(t).then(()=>{noticefade=1,n()})}async function post(e,t,n=1){n&&startLoading();var a=await fetch(e,{method:"POST",body:JSON.stringify(t),headers:{"content-type":"application/json"}}).then(e=>e.json());return n&&stopLoading(),a}async function sendToken(e=0){var t=V("email"),n=await post("/api/sendToken",{email:t,re:e});Notice(n.data)}async function Fetch(){var e=V("token"),t=V("email"),n=await post("/api/chkToken",{email:t,token:e});n.status?(Notice(n.data),showAll()):(Notice(n.data.error),E("token").Vue="")}async function add(){var e=V("name")+"."+zone_name,t=V("type"),n=V("content"),a=Number(V("ttl")),i=await post("/api/add",{email:V("email"),token:V("token"),record:{type:t,name:e,content:n,ttl:a}});console.log(i.data),i.status?(Notice(`success id:${i.data.result.id}`),sleep(1e3).then(Fetch)):Notice(`failed: ${i.data.error}`)}async function all(){var e=await post("/api/all",{email:V("email"),token:V("token")});return e.data}function CE(e){return document.createElement(e)}async function showAll(){function e(e){var t=CE("input");return t.value=e,t}function t(e){var t=CE("select"),n=["A","CNAME"];for(var a of n){var i=CE("option");i.innerText=a,i.value=a,e==a&&(i.selected="selected"),t.append(i)}return t}function n(e){var t=CE("select"),n={1:"AUTO",2:"2",5:"5",10:"10",15:"15",60:"1H",120:"2H",300:"5H",720:"12H",1440:"1D"};for(var a in n){var i=CE("option");i.value=a,i.innerText=n[a],e==a&&(i.selected="selected"),t.append(i)}return t}var a=await all(),i=E("items");for(var o of(i.innerHTML="",a)){var l=CE("tr"),r=CE("th"),c=CE("th"),d=CE("th"),s=CE("th"),u=CE("th");r.append(e(o.name.slice(0,o.name.length-zone_name.length-1))),r.align="left",c.append(t(o.type)),c.align="left",d.append(e(o.content)),d.align="left",s.append(n(o.ttl)),s.align="left";var p=CE("button"),f=CE("button");p.innerText="Del",p.onclick=(e=>{del(e.target.parentElement.parentElement.id)}),f.innerText="Edit",f.onclick=(e=>{edit(e.target.parentElement.parentElement.id)}),u.append(p,f),l.id=o.id,l.append(r,c,d,s,u),i.append(l)}}async function del(e){var t=await post("/api/del",{email:V("email"),token:V("token"),record:{id:e}});console.log(t.data),t.status?(Notice(`success id:${t.data.result.id}`),sleep(1e3).then(Fetch)):Notice(`failed: ${t.data.error}`)}async function edit(e){var t=E(e),n=t.children[0].children[0].value,a=t.children[1].children[0].value,i=t.children[2].children[0].value,o=t.children[3].children[0].value,l=await post("/api/edit",{email:V("email"),token:V("token"),record:{id:e,type:a,name:n,content:i,ttl:o}});console.log(l.data),l.status?(Notice(`success id:${l.data.result.id}`),sleep(1e3).then(Fetch)):Notice(`failed: ${l.data.error}`)}